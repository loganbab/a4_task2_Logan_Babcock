---
title: "Assignment 4 Task 2"
author: "Logan Babcock"
date: "November 4, 2021"
output: html_document
---

```{r setup, include=FALSE, messages = FALSE, warning = FALSE}
knitr::opts_chunk$set(echo = FALSE,  messages = FALSE, warning = FALSE, fig.align = "center")

library(tidyverse)
library(here)
library(janitor)
library(kableExtra)
library(lubridate)
library(effsize)


hares_raw <- read.csv(here("data", "bonanza_hares.csv"))

```

## 1. Overview
This is an exploratory report on juvenile snoeshoe hares (*Lepus americanus*) using data collected during the  US Long Term Ecological Research Network's study on Snowshoe hare physical data in the Bonanza Creek Experimental Forest. Using the data collected from 1999-2012, this report will analyze the counts and sizes of juvenile hares.

*COME BACK TO FINISH THIS  - add info on what the report contains*

## 2. Data and Methods
Snowshoe hare data and measurements were made accessible through Knut Kielland and associates at the Bonanza Creek LTER. The data contain measurements and observations on hares during a capture-recapture study done in Alaska's Tanana valley from 1999-2012. 

*COME BACK TO FINISH THIS - add info on stats tests and whats included* 

## Data Visualization and Analysis

### Juvenile Hare Survey Counts

```{r, layout="l-body-outset", fig.width = 10}

# finding juvenile hare counts

# making separate year column
hares_year <- hares_raw %>% # making new dataset with new date column
  mutate(date_new = mdy(date)) %>% # new column with date class
  mutate(year = year(date_new)) %>% # new column with just year
  filter(age == "j") # filtering for just juveniles

yearly_count <- hares_year %>% # making a dataset wiht just year and count
  group_by(year) %>% # grouping by year
  count() %>%  #adding all observations for that year
  rename(Year = year, Count = n)

yearly_count_wide <- pivot_wider(yearly_count, names_from = Year, values_from = Count)


kable(yearly_count_wide, caption = "Table 1: Number of juvenlie snowshoe hares caught per year" , align = "c") %>% # making a finalized table with title
  kable_styling(bootstrap_options = c("striped", "hover"), full_width = F) # customizing table

# visualizing the data

ggplot(data = yearly_count, aes(x = Year, y = Count)) + # makign a column chart to display counts
  geom_col(color = "white", fill = "coral2") + # adding some color to the graph
  scale_x_continuous(limits=c(1997,2013), breaks = 1999:2012) + #setting the x ais labels
  labs( title = "Hares Caught Each Year (Babcock)", caption = expression(paste(bold("Figure 1:"), " Number of juvenile hares caught during sampling from 1998-2012, with bar height representing number of individual hares."))) # adding a title and figure caption

# getting summary stats

 invisible(summary(yearly_count))

```

Above, Figure 1 shows the number of hares caught each year of the survey period. The number of hares caught vaired between 0 and 126. The minimum is `r min(yearly_count$Count)`, and the maximum is ` r max(yearly_count$Count)`. The mean number of hares caught is `r mean(yearly_count$Count)`, and the median is `r median(yearly_count$Count)`. The graph shows that the number of hares caught peaked at the beginning of the study in 1999. After this peak the number decreased until the first 0 catch year is recorded in 2002. The count then stayed below 50, with around every other year reaching 50, with low catch number in between. The second year of 0 caught occured in 2009, with the last three years of the survey seeing counts below 25. Ensuring that both the number of traps, and days of of the year the traps are set are equal and consistent accross the survey's years can help reduce variance resulting from the studies methods. 

### Juvenile Hare Weights

```{r, layout="l-body-outset", fig.width = 10}

# making a datasets with relevant data

hare_weights <- hares_raw %>% # make a new data set with variables site sex and weight
  filter(age == "j") %>% # only include juvenile values 
  select(grid, sex, weight) %>% 
  rename("site" = grid) %>%  # rename site column 
  na.omit(hare_weights) # exclude values with NA

f_weight <- hare_weights %>% #making a vector of values for just female hare weights
  filter(sex == "f") %>% # selecting female values
  pull(weight) # pulling the data for weights

m_weight <- hare_weights %>% #making vector of just male weights
  filter(sex =="m") %>% # selecting male values
  pull(weight) #pulling data for weights

# looking at the data w graphs

ggplot(data = hare_weights, aes(x = sex, y = weight)) + #exploratory scatter plot graph
  geom_jitter(aes(color = sex)) +
  facet_wrap(~ site) + # adding site as a face wrap for comparison
  labs(x = "Sex", y = "Weight (g)", title = "Plot of Juvenile Hare Wight by Sex and Site (Babcock)", caption = expression(paste(bold("Figure 2:"), "This plot shows the distribution of hare weights for each sex, faceted by survey site, where *f* is female and *m* is male.")))


ggplot(data = hare_weights, aes(x = weight, fill = sex)) + # exploratory histogram of weights with sex stacked
  geom_histogram(bins = 18, color = "white") + # setting bins at smaller value than default 30
  facet_wrap(~site) + # separating based on site to compare
  labs(x = "Weight (g)", y = "Percent of sample", legend = "Sex", title = "Histogram of Juvenile Hare Weights by Site and Sex (Babcock)", caption = expression(paste(bold("Figure 3:"), "This histogram shows the distribution of hare weights by percent of population, and is faceted by site"))) + # adding labels
  theme_light()


```

Figure 2 and Figure 3 above show the comparison between female and male juevenile showshoe hare weights first in a jitter plot and then in a side by sire histograms. In the jitter plot, the hares are separated by the site they were caught at, and it is clear that the least number of hares caught was at the Bonbs, and the most at the Bonrip site. At the Bonrip site, the female weights are more concentrated, and the male weights are more spread out. This is shown further in the histogram, where the percent female weights adhere to a more normal curve, and the male weights have a larger spread with less of a notable peak. The weights values do not vary largely between the sexes, or between site location.

### Juvenile hare weights comparison
```{r, include = FALSE}
# exploratory graphs

ggplot(hare_weights, aes(sample = weight)) + # exploratory qq plot faceted by sex
  geom_qq() +
  facet_wrap(~sex)

ggplot(hare_weights, aes(sample = weight)) + # exploratory qq plot with population considered together
  geom_qq()

# analyzing the data w a ttest 

weights_t <- t.test(f_weight, m_weight) # t test comparing weights based on sex
weights_t # view results of t test

# getting effect size 

weight_cohen <- cohen.d(f_weight, m_weight) # effect size
weight_cohen # viewing results 

```

```{r}
# Making summary table of statistics

summary_weights <- hare_weights %>% # making summary chart
  group_by(sex) %>% # grouping by sex
  summarize(
    mean = mean(weight), # summarizing mean, stand deviation, median, and counting sample size
    sd = sd(weight),
    median = median(weight),
    sample_size = n()) %>% 
  rename("Sex" = sex,  # renaming columns 
         "Standard Deviation" = "sd",
         "Median Size (g)" = "median", 
         "Count" = "sample_size")

kable(summary_weights, caption = "Table 2: Summary Statistics for Female and Male Juvenile Hare Weights", digits = 2, align = "c") %>% 
  kable_styling(bootstrap_options = c("striped", "hover"), full_width = F)

```
In this section we compared the weights of juvenile showshoe hares based on sex using a unpaired t-test, a Cohen's test to see the effect size, and using summary statistics.

Mean weight for female juvenile hares (`r round(summary_weights$mean[1])` g) is less than that for male juvenile hares (`r round(summary_weights$mean[2])` g). The effect size is small, with a Cohen's D of (Cohen's *d* = `r weight_cohen$estimate`). The difference between the means is significant (two-sample t-test, t = `r round(weights_t$statistic[3])`, p < 0.01)

Getting a p-value of `r weights_t[["p.value"]]` means that there is a 0.7% chance of getting means that are at least as different as those seen here if they're drawn from populations with the same mean. This means that we would reject the null hypothesis that the population's mean weights are the same.

### Juvenile Weight & Hind Foot Length

```{r}
# making data set with only weight and foot size included

weight_foot <- hares_raw %>% 
  filter(age == "j") %>% # getting juveniles
  select(weight, hindft) # keeping only columns for weight and hind ft

# visualizing the relationship

ggplot(data = weight_foot, aes(x = hindft, y = weight)) + # making a graph with the variables
  geom_point(color = "coral2") +
  labs(x = "Hindfoot Length (mm)", y = "Weight (g)", title = "Juvenile Hare Hindfoot Lenth and Weight Relationship (Babcock)", caption = expression(paste(bold("Figure 4:"), "Hindfoot lenth (mm) and hare weight in grams are plotted to visualize their relationship")))
  
```

```{r}
# linear model, stored as lm_hare

lm_hare <- lm(weight ~ hindft, data = weight_foot) # linear model with foot and weight measurements

# tidying the summary output

lm_hare_tidy <- broom::tidy(lm_hare) #using broom::tidy to make cleaner output table

# getting coefficient 

hare_coef <- lm_hare_tidy$estimate[2]

# metrics at a glance

lm_hare_glance <- broom::glance(lm_hare)

```

Simple linear regression was used to explore the relationship between juvenile snowshoe hare hindfoot lenth (mm) and body weight (g) across all three sampling sites, and including both male and female hares. A regression model was found ($\beta$ = `r round(hare_coef,3)`, F(`r lm_hare_glance$df`,`r lm_hare_glance$df.residual`) = `r round(lm_hare_glance$statistic,1)`, p < 0.001) with an R^2^ of `r round(lm_hare_glance$r.squared,3)`.
